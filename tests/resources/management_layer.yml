swagger: '2.0'

# OpenAPI 3.0 makes explicit provision for OpenID Connect. Unfortunately the tooling for OpenAPI 3.0
# is lagging and not usable at the time of writing (2017/12/08). We have to revisit this at a later stage.
securityDefinitions:
  OAuth2:
    type: oauth2
    flow: accessCode
    authorizationUrl: http://localhost:8000/openid/authorize
    tokenUrl: http:///localhost:8000/openid/token
    scopes:
      openid: Grants access to fields required by OpenID
      profile: Profile fields
      email: Email
      address: Addresses
      phone: Phone numbers
      roles: Grants access to user roles
      site: Grants access to site-specific data
  ApiKeyAuth:
    type: apiKey
    in: header
    name: Authorization
    description: Workaround for lack of OIDC support. Use "Bearer id_token_goes_here" as the value.

security:
  - OAuth2: []
  - ApiKeyAuth: []

schemes:
  - http
  - https

host: 'localhost:5000'

info:
  title: Management Layer API
  description: >
    The Management Layer API exposes the functionality that is available to users. Access to this API is based on a
    user token that must be presented with every request.


    The Management Layer ties together the User Data Store, Access Control System and Authentication Service.
    It performs permission checking and audit logging.
  version: ''

basePath: /api/v1

parameters:
  optional_portal_context_header:
    in: header
    name: X-GE-Portal-Context
    type: string
    required: false

  optional_nocache:
    description: An optional query parameter to instructing an API call to by pass caches when reading data.
    in: query
    name: nocache
    required: false
    type: boolean
    default: false

  optional_limit:
    description: An optional query parameter to limit the number of results returned.
    in: query
    name: limit
    required: false
    type: integer
    minimum: 1
    maximum: 100
    default: 20
    x-admin-on-rest-exclude: true

  optional_offset:
    description: >-
      An optional query parameter specifying the offset in the result set to
      start from.
    in: query
    name: offset
    required: false
    type: integer
    default: 0
    minimum: 0
    x-admin-on-rest-exclude: true

  optional_domain_filter:
    description: An optional query parameter to filter by domain_id
    in: query
    name: domain_id
    required: false
    type: integer
    x-related-info:
      rest_resource_name: domains
      label: name

  optional_invitation_filter:
    description: An optional query parameter to filter by invitation_id
    in: query
    name: invitation_id
    required: false
    type: string
    format: uuid

  optional_parent_filter:
    description: An optional query parameter to filter by parent_id
    in: query
    name: parent_id
    required: false
    type: integer
    x-related-info:
      rest_resource_name: domains
      label: name

  optional_role_filter:
    description: An optional query parameter to filter by role_id
    in: query
    name: role_id
    required: false
    type: integer
    x-related-info:
      rest_resource_name: roles
      label: label

  optional_user_filter:
    description: An optional query parameter to filter by user_id
    in: query
    name: user_id
    required: false
    type: string
    format: uuid

  optional_cutoff_date:
    description: An optional cutoff date to purge invites before this date
    in: query
    name: cutoff_date
    required: false
    type: string
    format: date

  synchronous_mode:
    description: Change the mode of the call to synchronous.
    in: query
    name: synchronous_mode
    required: false
    type: boolean
    default: false

  domain_id:
    description: A unique integer value identifying the domain.
    in: path
    name: domain_id
    required: true
    type: integer

  invitation_id:
    description: A UUID value identifying the invitation.
    in: path
    name: invitation_id
    required: true
    type: string
    format: uuid

  permission_id:
    description: A unique integer value identifying the permission.
    in: path
    name: permission_id
    required: true
    type: integer

  resource_id:
    description: A unique integer value identifying the resource.
    in: path
    name: resource_id
    required: true
    type: integer

  role_id:
    description: A unique integer value identifying the role.
    in: path
    name: role_id
    required: true
    type: integer

  site_id:
    description: A unique integer value identifying the site.
    in: path
    name: site_id
    required: true
    type: integer

  user_id:
    description: A UUID value identifying the user.
    in: path
    name: user_id
    required: true
    type: string
    format: uuid

  optional_deleter_id_filter:
    description: An optional query parameter to filter by deleter_id
    in: query
    name: deleter_id
    required: false
    type: string
    format: uuid

  optional_site_filter:
    description: An optional query parameter to filter by site_id
    in: query
    name: site_id
    required: false
    type: integer
    x-related-info:
      rest_resource_name: sites
      label: name

  admin_note_id:
    description: A unique integer value identifying the admin note.
    in: path
    name: admin_note_id
    required: true
    type: integer

  country_code:
    description: A unique two-character value identifying the country.
    in: path
    name: country_code
    required: true
    type: string
    minLength: 2
    maxLength: 2

  organisation_id:
    description: An integer identifying an organisation
    in: path
    name: organisation_id
    required: true
    type: integer

  client_id:
    description: A integer identifying the client
    in: path
    name: client_id
    required: true
    type: integer

definitions:
  country:
    type: object
    properties:
      code:
        type: string
        minLength: 2
        maxLength: 2
      name:
        type: string
        maxLength: 100
    required:
      - code
      - name

  domain:
    type: object
    properties:
      id:
        type: integer
        readOnly: true
      parent_id:
        type: integer
        x-related-info:
          model: domain
          label: name
      name:
        type: string
        maxLength: 100
      description:
        type: string
      created_at:
        type: string
        format: 'date-time'
        readOnly: true
      updated_at:
        type: string
        format: 'date-time'
        readOnly: true
    required:
      - id
      - name
      - created_at
      - updated_at

  domain_create:
    type: object
    properties:
      parent_id:
        type: integer
        x-related-info:
          model: domain
          label: name
      name:
        type: string
        maxLength: 100
      description:
        type: string
    required:
      - name

  domain_update:
    type: object
    properties:
      parent_id:
        type: integer
        x-related-info:
          model: domain
          label: name
      name:
        type: string
        maxLength: 100
      description:
        type: string
    minProperties: 1

  role_label:
    type: string
    maxLength: 100

  site:
    type: object
    properties:
      id:
        type: integer
        readOnly: true
      client_id:
        type: integer
        x-related-info:
          label: name
      domain_id:
        type: integer
        x-related-info:
          label: name
      name:
        type: string
        maxLength: 100
      description:
        type: string
      is_active:
        type: boolean
      created_at:
        type: string
        format: 'date-time'
        readOnly: true
      updated_at:
        type: string
        format: 'date-time'
        readOnly: true
    required:
      - id
      - domain_id
      - name
      - is_active
      - created_at
      - updated_at

  site_create:
    type: object
    properties:
      client_id:
        type: integer
        x-related-info:
          label: name
      domain_id:
        type: integer
        x-related-info:
          label: name
      name:
        type: string
        maxLength: 100
      is_active:
        type: boolean
      description:
        type: string
    required:
      - domain_id
      - name

  site_update:
    type: object
    properties:
      client_id:
        type: integer
        x-related-info:
          label: name
      domain_id:
        type: integer
        x-related-info:
          label: name
      name:
        type: string
        maxLength: 100
      description:
        type: string
      is_active:
        type: boolean
    minProperties: 1

  role:
    type: object
    properties:
      id:
        type: integer
        readOnly: true
      label:
        $ref: '#/definitions/role_label'
      requires_2fa:
        type: boolean
      description:
        type: string
      created_at:
        type: string
        format: 'date-time'
        readOnly: true
      updated_at:
        type: string
        format: 'date-time'
        readOnly: true
    required:
      - id
      - label
      - requires_2fa
      - created_at
      - updated_at

  role_create:
    type: object
    properties:
      label:
        $ref: '#/definitions/role_label'
      requires_2fa:
        type: boolean
        default: true
      description:
        type: string
    required:
      - label

  role_update:
    type: object
    properties:
      label:
        type: string
        maxLength: 100
      requires_2fa:
        type: boolean
      description:
        type: string
    minProperties: 1

  site_role:
    type: object
    properties:
      site_id:
        type: integer
        x-related-info:
          label: name
      role_id:
        type: integer
        x-related-info:
          label: label
      grant_implicitly:
        type: boolean
      created_at:
        type: string
        format: 'date-time'
        readOnly: true
      updated_at:
        type: string
        format: 'date-time'
        readOnly: true
    required:
      - site_id
      - role_id
      - grant_implicitly
      - created_at
      - updated_at

  site_role_create:
    type: object
    properties:
      site_id:
        type: integer
        x-related-info:
          label: name
      role_id:
        type: integer
        x-related-info:
          label: label
      grant_implicitly:
        type: boolean
    required:
      - site_id
      - role_id

  site_role_update:
    type: object
    properties:
      grant_implicitly:
        type: boolean
    minProperties: 1

  domain_role:
    type: object
    properties:
      domain_id:
        type: integer
        x-related-info:
          label: name
      role_id:
        type: integer
        x-related-info:
          label: label
      grant_implicitly:
        type: boolean
      created_at:
        type: string
        format: 'date-time'
        readOnly: true
      updated_at:
        type: string
        format: 'date-time'
        readOnly: true
    required:
      - domain_id
      - role_id
      - grant_implicitly
      - created_at
      - updated_at

  domain_role_create:
    type: object
    properties:
      domain_id:
        type: integer
        x-related-info:
          label: name
      role_id:
        type: integer
        x-related-info:
          label: label
      grant_implicitly:
        type: boolean
    required:
      - domain_id
      - role_id

  domain_role_update:
    type: object
    properties:
      grant_implicitly:
        type: boolean
    minProperties: 1

  user_domain_role:
    type: object
    properties:
      user_id:
        type: string
        format: uuid
        x-related-info:
          label: username
      domain_id:
        type: integer
        x-related-info:
          label: name
      role_id:
        type: integer
        x-related-info:
          label: label
      created_at:
        type: string
        format: 'date-time'
        readOnly: true
      updated_at:
        type: string
        format: 'date-time'
        readOnly: true
    required:
      - user_id
      - domain_id
      - role_id
      - created_at
      - updated_at

  user_domain_role_create:
    type: object
    properties:
      user_id:
        type: string
        format: uuid
        x-related-info:
          label: username
      domain_id:
        type: integer
        x-related-info:
          label: name
      role_id:
        type: integer
        x-related-info:
          label: label
    required:
      - user_id
      - domain_id
      - role_id

  user_site_role:
    type: object
    properties:
      user_id:
        type: string
        format: uuid
        x-related-info:
          label: username
      site_id:
        type: integer
        x-related-info:
          label: name
      role_id:
        type: integer
        x-related-info:
          label: label
      created_at:
        type: string
        format: 'date-time'
        readOnly: true
      updated_at:
        type: string
        format: 'date-time'
        readOnly: true
    required:
      - user_id
      - site_id
      - role_id
      - created_at
      - updated_at

  user_site_role_create:
    type: object
    properties:
      user_id:
        type: string
        format: uuid
        x-related-info:
          label: username
      site_id:
        type: integer
        x-related-info:
          label: name
      role_id:
        type: integer
        x-related-info:
          label: label
    required:
      - user_id
      - site_id
      - role_id

  permission:
    type: object
    properties:
      id:
        type: integer
        readOnly: true
      name:
        type: string
        maxLength: 50
      description:
        type: string
      created_at:
        type: string
        format: 'date-time'
        readOnly: true
      updated_at:
        type: string
        format: 'date-time'
        readOnly: true
    required:
      - id
      - name
      - created_at
      - updated_at

  permission_create:
    type: object
    properties:
      name:
        type: string
        maxLength: 50
      description:
        type: string
    required:
      - name

  permission_update:
    type: object
    properties:
      name:
        type: string
        maxLength: 50
      description:
        type: string
    minProperties: 1

  resource:
    type: object
    properties:
      id:
        type: integer
        readOnly: true
      urn:
        type: string
        format: uri
      description:
        type: string
      created_at:
        type: string
        format: 'date-time'
        readOnly: true
      updated_at:
        type: string
        format: 'date-time'
        readOnly: true
    required:
      - id
      - urn
      - created_at
      - updated_at

  resource_create:
    type: object
    properties:
      urn:
        type: string
        format: uri
      description:
        type: string
    required:
      - urn

  resource_update:
    type: object
    properties:
      urn:
        type: string
        format: uri
      description:
        type: string
    minProperties: 1

  role_resource_permission:
    type: object
    properties:
      role_id:
        type: integer
        x-related-info:
          label: label
      resource_id:
        type: integer
        x-related-info:
          label: urn
      permission_id:
        type: integer
        x-related-info:
          label: name
      created_at:
        type: string
        format: 'date-time'
        readOnly: true
      updated_at:
        type: string
        format: 'date-time'
        readOnly: true
    required:
      - role_id
      - resource_id
      - permission_id
      - created_at
      - updated_at

  role_resource_permission_create:
    type: object
    properties:
      role_id:
        type: integer
        x-related-info:
          label: label
      resource_id:
        type: integer
        x-related-info:
          label: urn
      permission_id:
        type: integer
        x-related-info:
          label: name
    required:
      - role_id
      - resource_id
      - permission_id

  invitation:
    type: object
    properties:
      id:
        type: string
        format: uuid
        readOnly: true
      invitor_id:
        type: string
        format: uuid
        description: The user that created the invitation
        readOnly: true
        x-related-info:
          model: user
          label: username
      first_name:
        type: string
        maxLength: 100
      last_name:
        type: string
        maxLength: 100
      email:
        type: string
        format: email
      organisation_id:
        type: integer
        x-related-info:
          model: organisation
          label: name
      expires_at:
        type: string
        format: 'date-time'
      created_at:
        type: string
        format: 'date-time'
        readOnly: true
      updated_at:
        type: string
        format: 'date-time'
        readOnly: true
    required:
      - id
      - invitor_id
      - first_name
      - last_name
      - email
      - organisation_id
      - expires_at
      - created_at
      - updated_at

  invitation_create:
    type: object
    properties:
      first_name:
        type: string
        maxLength: 100
      last_name:
        type: string
        maxLength: 100
      email:
        type: string
        format: email
      organisation_id:
        type: integer
        x-related-info:
          model: organisation
          label: name
      expires_at:
        type: string
        format: 'date-time'
    required:
      - first_name
      - last_name
      - email
      - organisation_id

  invitation_update:
    type: object
    properties:
      first_name:
        type: string
        maxLength: 100
      last_name:
        type: string
        maxLength: 100
      email:
        type: string
        format: email
      organisation_id:
        type: integer
        x-related-info:
          model: organisation
          label: name
      expires_at:
        type: string
        format: 'date-time'
    minProperties: 1

  invitation_domain_role:
    type: object
    properties:
      invitation_id:
        type: string
        format: uuid
        x-related-info:
          label: email
      domain_id:
        type: integer
        x-related-info:
          label: name
      role_id:
        type: integer
        x-related-info:
          label: label
      created_at:
        type: string
        format: 'date-time'
        readOnly: true
      updated_at:
        type: string
        format: 'date-time'
        readOnly: true
    required:
      - invitation_id
      - domain_id
      - role_id
      - created_at
      - updated_at

  invitation_domain_role_create:
    type: object
    properties:
      invitation_id:
        type: string
        format: uuid
        x-related-info:
          label: email
      domain_id:
        type: integer
        x-related-info:
          label: name
      role_id:
        type: integer
        x-related-info:
          label: label
    required:
      - invitation_id
      - domain_id
      - role_id

  invitation_site_role:
    type: object
    properties:
      invitation_id:
        type: string
        format: uuid
        x-related-info:
          label: email
      site_id:
        type: integer
        x-related-info:
          label: name
      role_id:
        type: integer
        x-related-info:
          label: label
      created_at:
        type: string
        format: 'date-time'
        readOnly: true
      updated_at:
        type: string
        format: 'date-time'
        readOnly: true
    required:
      - invitation_id
      - site_id
      - role_id
      - created_at
      - updated_at

  invitation_site_role_create:
    type: object
    properties:
      invitation_id:
        type: string
        format: uuid
        x-related-info:
          label: email
      site_id:
        type: integer
        x-related-info:
          label: name
      role_id:
        type: integer
        x-related-info:
          label: label
    required:
      - invitation_id
      - site_id
      - role_id

  site_role_labels_aggregated:
    description: 'An object containing a site ID and an aggregated list of all the role labels supported
      by the site and all the domains in its lineage.'
    type: object
    properties:
      site_id:
        type: integer
      roles:
        type: array
        items:
          $ref: '#/definitions/role_label'

  user_site_role_labels_aggregated:
    description: 'An object containing a user ID, site ID and an aggregated list of all the role labels
      assigned to the user for the site and all the domains in its lineage.'
    type: object
    properties:
      user_id:
        type: string
        format: uuid
      site_id:
        type: integer
      roles:
        type: array
        items:
          $ref: '#/definitions/role_label'

  domain_roles:
    description: "An object containing the domain roles defined for a given domain and its lineage."
    type: object
    properties:
      domain_id:
        description: 'The domain for which the request was made.'
        type: integer
      roles_map:
        description: 'A dictionary where the keys are domain ids prefixed with `d:` and the values are lists of role ids.'
        type: object
        additionalProperties:
          description: 'The list of role ids for the domain'
          type: array
          items:
            type: integer
        example:
          "d:1": [1]
          "d:2": [1, 2]
    required:
      - domain_id
      - roles_map

  site_and_domain_roles:
    description: 'An object containing the site- and domain lineage roles defined for a given site.'
    type: object
    properties:
      site_id:
        description: 'The site for which the request was made.'
        type: integer
      roles_map:
        description: 'A dictionary where the keys are site and domain ids prefixed with `s:` and `d:`, respectively
           and the values are lists of role ids.'
        type: object
        additionalProperties:
          description: 'The list of role ids for the site or domain'
          type: array
          items:
            type: integer
        example:
          "s:1": [1, 2, 3]
          "d:1": [1]
          "d:2": [1, 2]
    required:
      - site_id
      - roles_map

  all_user_roles:
    description: 'An object containing the effective roles that a user has in any place in the organisational tree.'
    type: object
    properties:
      user_id:
        type: string
        format: uuid
      roles_map:
        type: object
        description: 'Domain and site roles'
        additionalProperties:
          type: array
          items:
            type: integer
        example:
          "s:1": [1, 2, 3]
          "d:1": [1]
          "d:2": [1, 2]
    required:
      - user_id
      - roles_map

  admin_note:
    type: object
    properties:
      id:
        type: integer
        readOnly: true
      user_id:
        type: string
        format: uuid
        x-related-info:
          label: username
      creator_id:
        type: string
        format: uuid
        readOnly: true
        description: The user making the request will be considered the creator and thus this field is not available
          when creating admin note.
        x-related-info:
          model: user
          label: username
      note:
        type: string
      created_at:
        type: string
        format: 'date-time'
        readOnly: true
      updated_at:
        type: string
        format: 'date-time'
        readOnly: true
    required:
      - id
      - user_id
      - creator_id
      - note
      - created_at
      - updated_at

  admin_note_create:
    type: object
    properties:
      user_id:
        type: string
        format: uuid
        x-related-info:
          label: username
      note:
        type: string
    required:
      - user_id
      - note

  admin_note_update:
    type: object
    properties:
      note:
        type: string
    minProperties: 1

  site_data_schema:
    type: object
    properties:
      site_id:
        type: integer
        x-related-info:
          label: name
      schema:
        type: object
      created_at:
        type: string
        format: 'date-time'
        readOnly: true
      updated_at:
        type: string
        format: 'date-time'
        readOnly: true
    required:
      - site_id
      - schema
      - created_at
      - updated_at

  site_data_schema_create:
    type: object
    properties:
      site_id:
        type: integer
        x-related-info:
          label: name
      schema:
        type: object
    required:
      - site_id
      - schema

  site_data_schema_update:
    type: object
    properties:
      schema:
        type: object
    minProperties: 1

  user_site_data:
    type: object
    properties:
      user_id:
        type: string
        format: uuid
        x-related-info:
          label: username
      site_id:
        type: integer
        x-related-info:
          label: name
      data:
        type: object
      created_at:
        type: string
        format: date-time
        readOnly: true
      updated_at:
        type: string
        format: date-time
        readOnly: true
    required:
      - user_id
      - site_id
      - data
      - created_at
      - updated_at

  user_site_data_create:
    type: object
    properties:
      user_id:
        type: string
        format: uuid
        x-related-info:
          label: username
      site_id:
        type: integer
        x-related-info:
          label: name
      data:
        type: object
    required:
      - user_id
      - site_id
      - data

  user_site_data_update:
    type: object
    properties:
      data:
        type: object
    minProperties: 1

  deleted_user:
    type: object
    properties:
      id:
        type: string
        format: uuid
      username:
        type: string
      email:
        type: string
        format: email
      msisdn:
        type: string
      reason:
        type: string
      created_at:
        type: string
        format: date-time
        readOnly: true
      updated_at:
        type: string
        format: date-time
        readOnly: true
      deleted_at:
        type: string
        format: date-time
      deleter_id:
        type: string
        format: uuid
    required:
      - id
      - username
      - reason
      - created_at
      - updated_at
      - deleter_id

  deleted_user_create:
    type: object
    properties:
      id:
        type: string
        format: uuid
      username:
        type: string
      email:
        type: string
        format: email
      msisdn:
        type: string
      reason:
        type: string
    required:
      - id
      - username
      - reason

  deleted_user_update:
    type: object
    properties:
      username:
        type: string
      email:
        type: string
        format: email
      msisdn:
        type: string
      reason:
        type: string
      deleted_at:
        type: string
        format: date-time
    minProperties: 1

  deleted_user_site:
    type: object
    properties:
      deleted_user_id:
        type: string
        format: uuid
        x-related-info:
          model: deleted_user
          label: username
      site_id:
        type: integer
        x-related-info:
          model: site
          label: name
      created_at:
        type: string
        format: date-time
        readOnly: true
      updated_at:
        type: string
        format: date-time
        readOnly: true
      deletion_requested_at:
        type: string
        format: date-time
      deletion_requested_via:
        type: string
      deletion_confirmed_at:
        type: string
        format: date-time
      deletion_confirmed_via:
        type: string
    required:
      - deleted_user_id
      - site_id
      - created_at
      - updated_at

  deleted_user_site_create:
    type: object
    properties:
      deleted_user_id:
        type: string
        format: uuid
        x-related-info:
          model: deleted_user
          label: username
      site_id:
        type: integer
        x-related-info:
          model: site
          label: name
      deletion_requested_at:
        type: string
        format: date-time
      deletion_requested_via:
        type: string
      deletion_confirmed_at:
        type: string
        format: date-time
      deletion_confirmed_via:
        type: string
    required:
      - deleted_user_id
      - site_id

  deleted_user_site_update:
    type: object
    properties:
      deletion_requested_at:
        type: string
        format: date-time
      deletion_requested_via:
        type: string
      deletion_confirmed_at:
        type: string
        format: date-time
      deletion_confirmed_via:
        type: string
    minProperties: 1

  request_user_deletion:
    type: object
    properties:
      user_id:
        type: string
        format: uuid
      reason:
        type: string
    required:
      - user_id
      - reason

  client:
    type: object
    properties:
      id:
        type: integer
        readOnly: true
      _post_logout_redirect_uris:
        description: New-line delimited list of post-logout redirect URIs
        type: string
      _redirect_uris:
        description: New-line delimited list of redirect URIs
        type: string
      client_id:
        description: ''
        type: string
        x-related-info:
          model: null
      contact_email:
        description: ''
        type: string
      logo:
        description: ''
        type: string
        format: uri
      name:
        description: ''
        type: string
      require_consent:
        description: 'If disabled, the Server will NEVER ask the user for consent.'
        type: boolean
      response_type:
        description: ''
        type: string
      reuse_consent:
        description: >-
          If enabled, the Server will save the user consent given to a
          specific client, so that user will not be prompted for the same
          authorization multiple times.
        type: boolean
      terms_url:
        description: External reference to the privacy policy of the client.
        type: string
        format: uri
      website_url:
        description: ''
        type: string
        format: uri
    required:
      - id
      - client_id
      - response_type

  organisation:
    type: object
    properties:
      id:
        type: integer
      name:
        type: string
      description:
        type: string
      created_at:
        type: string
        format: date-time
        readOnly: true
      updated_at:
        type: string
        format: date-time
        readOnly: true
    required:
      - id
      - name
      - description
      - created_at
      - updated_at

  organisation_create:
    type: object
    properties:
      name:
        type: string
      description:
        type: string
    required:
      - name

  organisation_update:
    type: object
    properties:
      name:
        type: string
      description:
        type: string
    minProperties: 1

  user:
    type: object
    properties:
      id:
        description: The UUID of the user
        type: string
        format: uuid
        readOnly: true
      username:
        description: >-
          Required. 150 characters or fewer. Letters, digits and
          @/./+/-/_ only.
        type: string
        readOnly: true
      first_name:
        description: ''
        type: string
      last_name:
        description: ''
        type: string
      email:
        description: ''
        type: string
        format: email
      is_active:
        description: >-
          Designates whether this user should be treated as active.
          Deselect this instead of deleting accounts.
        type: boolean
      date_joined:
        description: ''
        type: string
        format: date
        readOnly: true
      last_login:
        description: ''
        type: string
        format: 'date-time'
        readOnly: true
      email_verified:
        type: boolean
      msisdn_verified:
        type: boolean
      msisdn:
        type: string
        maxLength: 15
      gender:
        type: string
      birth_date:
        type: string
        format: date
      avatar:
        type: string
        format: uri
      country_code:
        type: string
        minLength: 2
        maxLength: 2
        x-related-info:
          model: country
          field: code
          label: name
      organisation_id:
        type: integer
        readOnly: true
        x-related-info:
          model: organisation
          label: name
      created_at:
        type: string
        format: date-time
        readOnly: true
      updated_at:
        type: string
        format: date-time
        readOnly: true
    required:
      - id
      - username
      - is_active
      - date_joined
      - created_at
      - updated_at

  user_update:
    type: object
    properties:
      first_name:
        description: ''
        type: string
      last_name:
        description: ''
        type: string
      email:
        description: ''
        type: string
        format: email
      is_active:
        description: >-
          Designates whether this user should be treated as active.
          Deselect this instead of deleting accounts.
        type: boolean
      email_verified:
        type: boolean
      msisdn_verified:
        type: boolean
      msisdn:
        type: string
        maxLength: 15
      gender:
        type: string
      birth_date:
        type: string
        format: date
      avatar:
        type: string
        format: uri
      country_code:
        type: string
        minLength: 2
        maxLength: 2
        x-related-info:
          model: country
          field: code
          label: name
    minProperties: 1

  resource_permission:
    type: object
    properties:
      resource:
        type: string
        format: uri
      permission:
        type: string
    required:
      - resource
      - permission

  user_permissions_check:
    type: object
    properties:
      operator:
        type: string
        enum: [all, any]
      resource_permissions:
        type: array
        items:
          $ref: '#/definitions/resource_permission'
      site_id:
        type: integer
      domain_id:
        type: integer
      nocache:
        type: boolean
        default: false
    required:
      - operator
      - resource_permissions
      # site_id or domain_id is required

  user_permissions_check_response:
    type: object
    properties:
      has_permissions:
        type: boolean
    required:
      - has_permissions

  user_with_roles:
    description: 'A user with their roles.'
    type: object
    properties:
      id:
        type: string
        format: uuid
      username:
        type: string
      roles:
        type: array
        items:
          type: string

  health_info:
    description: 'Health check response'
    type: object
    properties:
      host:
        type: string
      server_timestamp:
        type: string
        format: 'date-time'
      version:
        type: string
      access_control_health:
        type: object
      user_data_store_health:
        type: object
      authentication_service_health:
        type: object

    required:
    - host
    - server_timestamp
    - version
    - access_control_health
    - user_data_store_health
    - authentication_service_health

  purged_invitations:
    type: object
    properties:
      mode:
        type: string
        enum:
          - asynchronous
          - synchronous
      amount:
        type: integer
    required:
      - mode

paths:
  /healthcheck:
    get:
      security: [ ]
      description: 'Get the status of the service.'
      operationId: healthcheck
      produces:
        - application/json
      responses:
        200:
          description: 'The service is operating normally.'
          schema:
            $ref: '#/definitions/health_info'

  /refresh/all:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/optional_nocache'
    get:
      description: "Refresh all mapping information"
      operationId: refresh_all
      produces:
        - application/json
      responses:
        200:
          description: "Successfully refreshed all mapping data"
        403:
         description: "Forbidden"

  /refresh/clients:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/optional_nocache'
    get:
      description: "Refresh OIDC client information"
      operationId: refresh_clients
      produces:
        - application/json
      responses:
        200:
          description: "Successfully refreshed OIDC client data"
        403:
         description: "Forbidden"

  /refresh/domains:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/optional_nocache'
    get:
      description: "Refresh domain mapping information"
      operationId: refresh_domains
      produces:
        - application/json
      responses:
        200:
          description: "Successfully refreshed domain mapping data"
        403:
         description: "Forbidden"

  /refresh/keys:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/optional_nocache'
    get:
      description: "Refresh JWKS information"
      operationId: refresh_keys
      produces:
        - application/json
      responses:
        200:
          description: "Successfully refreshed keys data"
        403:
         description: "Forbidden"

  /refresh/permissions:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/optional_nocache'
    get:
      description: "Refresh permission mapping information"
      operationId: refresh_permissions
      produces:
        - application/json
      responses:
        200:
          description: "Successfully refreshed permission mapping data"
        403:
         description: "Forbidden"

  /refresh/resources:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/optional_nocache'
    get:
      description: "Refresh resource mapping information"
      operationId: refresh_resources
      produces:
        - application/json
      responses:
        200:
          description: "Successfully refreshed resource mapping data"
        403:
         description: "Forbidden"

  /refresh/roles:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/optional_nocache'
    get:
      description: "Refresh role mapping information"
      operationId: refresh_roles
      produces:
        - application/json
      responses:
        200:
          description: "Successfully refreshed role mapping data"
        403:
         description: "Forbidden"

  /refresh/sites:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/optional_nocache'
    get:
      description: "Refresh site mapping information"
      operationId: refresh_sites
      produces:
        - application/json
      responses:
        200:
          description: "Successfully refreshed site mapping data"
        403:
         description: "Forbidden"

  /ops/get_sites_under_domain/{domain_id}:
    parameters:
      - $ref: '#/parameters/domain_id'
    get:
      description: 'Get a list of all sites linked directly or indirectly to the specified domain.'
      operationId: get_sites_under_domain
      produces:
        - application/json
      responses:
        200:
          description: ''
          schema:
            type: array
            items:
              $ref: '#/definitions/site'
        403:
          description: 'Forbidden'
      tags:
        - operational

  /ops/get_site_from_client_token_id/{client_token_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - description: A client token id. This is not the primary key of the client table, but rather the client id
                     that is typically configured along with the client secret.
        in: path
        name: client_token_id
        required: true
        type: string
      - $ref: '#/parameters/optional_nocache'
    get:
      description: "Get the site associated with the specified client token id"
      operationId: get_site_from_client_token_id
      produces:
        - application/json
      responses:
        200:
          description: ''
          schema:
            $ref: '#/definitions/site'
        403:
          description: 'Forbidden'
      tags:
        - operational

  /ops/user_management_portal_permissions/{user_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/user_id'
      - $ref: '#/parameters/optional_nocache'
    get:
      deprecated: true
      description: "(DEPRECATED. Use /ops/user_site_permissions instead.) Get a list of all permissions a user has on the Management Portal"
      operationId: get_user_management_portal_permissions
      produces:
        - application/json
      responses:
        200:
          description: ''
          schema:
            type: array
            items:
              type: string
            uniqueItems: true
        403:
          description: 'Forbidden'
      tags:
        - operational

  /ops/user_domain_permissions/{user_id}/{domain_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/user_id'
      - $ref: '#/parameters/domain_id'
      - $ref: '#/parameters/optional_nocache'
    get:
      description: "Get a list of all resource permissions a user has on the specified domain"
      operationId: get_user_domain_permissions
      produces:
        - application/json
      responses:
        200:
          description: ''
          schema:
            type: array
            items:
              type: string
            uniqueItems: true
        403:
          description: 'Forbidden'
      tags:
        - operational

  /ops/user_site_permissions/{user_id}/{site_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/user_id'
      - $ref: '#/parameters/site_id'
      - $ref: '#/parameters/optional_nocache'
    get:
      description: "Get a list of all resource permissions a user has on the specified site"
      operationId: get_user_site_permissions
      produces:
        - application/json
      responses:
        200:
          description: ''
          schema:
            type: array
            items:
              type: string
            uniqueItems: true
        403:
          description: 'Forbidden'
      tags:
        - operational

  /ops/site_role_labels_aggregated/{site_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/site_id'
    get:
      description: "Get a list of all possible role labels that a user can have from the specified sites perspective."
      operationId: get_site_role_labels_aggregated
      produces:
        - application/json
      responses:
        200:
          description: ''
          schema:
            $ref: '#/definitions/site_role_labels_aggregated'
        403:
          description: 'Forbidden'
      tags:
        - operational

  /ops/user_site_role_labels_aggregated/{user_id}/{site_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/user_id'
      - $ref: '#/parameters/site_id'
    get:
      description: "Get a list of all role labels that the specified user has from the specified sites perspective."
      operationId: get_user_site_role_labels_aggregated
      produces:
        - application/json
      responses:
        200:
          description: ''
          schema:
            $ref: '#/definitions/user_site_role_labels_aggregated'
        403:
          description: 'Forbidden'
      tags:
        - operational

  /ops/domain_roles/{domain_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/domain_id'
    get:
      description: "Get the domain and its lineages roles defined for a domain."
      operationId: get_domain_roles
      produces:
        - application/json
      responses:
        200:
          description: ''
          schema:
            $ref: '#/definitions/domain_roles'
        403:
          description: 'Forbidden'
      tags:
        - operational

  /ops/site_and_domain_roles/{site_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/site_id'
    get:
      description: 'Get the site- and domain lineage roles defined for a given site.'
      operationId: get_site_and_domain_roles
      produces:
        - application/json
      responses:
        200:
          description: ''
          schema:
            $ref: '#/definitions/site_and_domain_roles'
        403:
          description: 'Forbidden'
      tags:
        - operational

  /ops/all_user_roles/{user_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/user_id'
    get:
      description: 'Get the effective roles that a user has at any place in the organisational tree.'
      operationId: get_all_user_roles
      produces:
        - application/json
      responses:
        200:
          description: ''
          schema:
            $ref: '#/definitions/all_user_roles'
        403:
          description: 'Forbidden'
        404:
          description: 'User not found'
      tags:
        - operational

  /ops/users_with_roles_for_domain/{domain_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/domain_id'
    get:
      description: 'Get a list of Users with their effective roles within the given domain.'
      operationId: get_users_with_roles_for_domain
      produces:
        - application/json
      responses:
        200:
          description: ''
          schema:
            type: array
            items:
              $ref: '#/definitions/user_with_roles'
        403:
          description: 'Forbidden'
        404:
          description: 'Domain not found'
      tags:
        - operational

  /ops/users_with_roles_for_site/{site_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/site_id'
    get:
      description: 'Get a list of Users with their effective roles within the given site.'
      operationId: get_users_with_roles_for_site
      produces:
        - application/json
      responses:
        200:
          description: ''
          schema:
            type: array
            items:
              $ref: '#/definitions/user_with_roles'
        403:
          description: 'Forbidden'
        404:
          description: 'Site not found'
      tags:
        - operational

  /ops/user_has_permissions/{user_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/user_id'
      - in: body
        name: data
        schema:
          $ref: '#/definitions/user_permissions_check'
    post:
      description: 'Check of the user has the specified resource permissions'
      operationId: user_has_permissions
      consumes:
        - application/json
      produces:
        - application/json
      responses:
        200:
          description: 'True if the user has the permissions, else False'
          schema:
            $ref: '#/definitions/user_permissions_check_response'
        403:
          description: 'Forbidden'
        400:
          description: 'Bad Request'
        404:
          description: 'User not found'
      tags:
        - operational

  /domains:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: domain_list
      x-aor-permissions:
        - 'urn:ge:access_control:domain:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - $ref: '#/parameters/optional_parent_filter'
        - name: domain_ids
          description: An optional list of domain ids
          in: query
          type: array
          items:
            type: integer
          required: false
          minItems: 1
          collectionFormat: csv
          uniqueItems: true
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/domain'
      tags:
        - access_control
    post:
      consumes:
        - application/json
      operationId: domain_create
      x-aor-permissions:
        - 'urn:ge:access_control:domain:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/domain_create'
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/domain'
      tags:
        - access_control

  /domains/{domain_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/domain_id'
    delete:
      operationId: domain_delete
      x-aor-permissions:
        - 'urn:ge:access_control:domain:delete'
      responses:
        '204':
          description: ''
      tags:
        - access_control
    get:
      operationId: domain_read
      x-aor-permissions:
        - 'urn:ge:access_control:domain:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/domain'
      tags:
        - access_control
    put:
      consumes:
        - application/json
      operationId: domain_update
      x-aor-permissions:
        - 'urn:ge:access_control:domain:update'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/domain_update'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/domain'
      tags:
        - access_control

  /domainroles:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: domainrole_list
      x-aor-permissions:
        - 'urn:ge:access_control:domainrole:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - $ref: '#/parameters/optional_domain_filter'
        - $ref: '#/parameters/optional_role_filter'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/domain_role'
      tags:
        - access_control
    post:
      consumes:
        - application/json
      operationId: domainrole_create
      x-aor-permissions:
        - 'urn:ge:access_control:domainrole:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/domain_role_create'
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/domain_role'
      tags:
        - access_control

  '/domainroles/{domain_id}/{role_id}':
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/domain_id'
      - $ref: '#/parameters/role_id'
    delete:
      operationId: domainrole_delete
      x-aor-permissions:
        - 'urn:ge:access_control:domainrole:delete'
      responses:
        '204':
          description: ''
      tags:
        - access_control
    get:
      operationId: domainrole_read
      x-aor-permissions:
        - 'urn:ge:access_control:domainrole:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/domain_role'
      tags:
        - access_control
    put:
      consumes:
        - application/json
      operationId: domainrole_update
      x-aor-permissions:
        - 'urn:ge:access_control:domainrole:update'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/domain_role_update'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/domain_role'
      tags:
        - access_control

  /invitations:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: invitation_list
      x-aor-permissions:
        - 'urn:ge:access_control:invitation:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - description: Optional filter based on the invitor (the user who created the invitation)
          name: invitor_id
          in: query
          required: false
          type: string
          format: uuid
        - name: invitation_ids
          description: An optional list of invitation ids
          in: query
          type: array
          items:
            type: string
            format: uuid
          required: false
          minItems: 1
          collectionFormat: csv
          uniqueItems: true
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/invitation'
      tags:
        - access_control
    post:
      consumes:
        - application/json
      operationId: invitation_create
      x-aor-permissions:
        - 'urn:ge:access_control:invitation:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/invitation_create'
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/invitation'
      tags:
        - access_control

  '/invitations/{invitation_id}':
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/invitation_id'
    delete:
      operationId: invitation_delete
      x-aor-permissions:
        - 'urn:ge:access_control:invitation:delete'
      responses:
        '204':
          description: ''
      tags:
        - access_control
    get:
      operationId: invitation_read
      x-aor-permissions:
        - 'urn:ge:access_control:invitation:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/invitation'
      tags:
        - access_control
    put:
      consumes:
        - application/json
      operationId: invitation_update
      x-aor-permissions:
        - 'urn:ge:access_control:invitation:update'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/invitation_update'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/invitation'
      tags:
        - access_control

  /invitationdomainroles:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: invitationdomainrole_list
      x-aor-permissions:
        - 'urn:ge:access_control:invitationdomainrole:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - $ref: '#/parameters/optional_invitation_filter'
        - $ref: '#/parameters/optional_domain_filter'
        - $ref: '#/parameters/optional_role_filter'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/invitation_domain_role'
      tags:
        - access_control
    post:
      consumes:
        - application/json
      operationId: invitationdomainrole_create
      x-aor-permissions:
        - 'urn:ge:access_control:invitationdomainrole:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/invitation_domain_role_create'
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/invitation_domain_role'
      tags:
        - access_control

  '/invitationdomainroles/{invitation_id}/{domain_id}/{role_id}':
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/invitation_id'
      - $ref: '#/parameters/domain_id'
      - $ref: '#/parameters/role_id'
    delete:
      operationId: invitationdomainrole_delete
      x-aor-permissions:
        - 'urn:ge:access_control:invitationdomainrole:delete'
      produces:
        - application/json
      responses:
        '204':
          description: ''
      tags:
        - access_control
    get:
      operationId: invitationdomainrole_read
      x-aor-permissions:
        - 'urn:ge:access_control:invitationdomainrole:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/invitation_domain_role'
      tags:
        - access_control

  /invitationsiteroles:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: invitationsiterole_list
      x-aor-permissions:
        - 'urn:ge:access_control:invitationsiterole:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - $ref: '#/parameters/optional_invitation_filter'
        - $ref: '#/parameters/optional_site_filter'
        - $ref: '#/parameters/optional_role_filter'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/invitation_site_role'
      tags:
        - access_control
    post:
      consumes:
        - application/json
      operationId: invitationsiterole_create
      x-aor-permissions:
        - 'urn:ge:access_control:invitationsiterole:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/invitation_site_role_create'
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/invitation_site_role'
      tags:
        - access_control

  '/invitationsiteroles/{invitation_id}/{site_id}/{role_id}':
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/invitation_id'
      - $ref: '#/parameters/site_id'
      - $ref: '#/parameters/role_id'
    delete:
      operationId: invitationsiterole_delete
      x-aor-permissions:
        - 'urn:ge:access_control:invitationsiterole:delete'
      responses:
        '204':
          description: ''
      tags:
        - access_control
    get:
      operationId: invitationsiterole_read
      x-aor-permissions:
        - 'urn:ge:access_control:invitationsiterole:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/invitation_site_role'
      tags:
        - access_control

  /permissions:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: permission_list
      x-aor-permissions:
        - 'urn:ge:access_control:permission:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - name: permission_ids
          description: An optional list of permission ids
          in: query
          type: array
          items:
            type: integer
          required: false
          minItems: 1
          collectionFormat: csv
          uniqueItems: true
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/permission'
      tags:
        - access_control
    post:
      consumes:
        - application/json
      operationId: permission_create
      x-aor-permissions:
        - 'urn:ge:access_control:permission:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/permission_create'
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/permission'
      tags:
        - access_control

  '/permissions/{permission_id}':
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/permission_id'
    delete:
      operationId: permission_delete
      x-aor-permissions:
        - 'urn:ge:access_control:permission:delete'
      responses:
        '204':
          description: ''
      tags:
        - access_control
    get:
      operationId: permission_read
      x-aor-permissions:
        - 'urn:ge:access_control:permission:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/permission'
      tags:
        - access_control
    put:
      consumes:
        - application/json
      operationId: permission_update
      x-aor-permissions:
        - 'urn:ge:access_control:permission:update'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/permission_update'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/permission'
      tags:
        - access_control

  /resources:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: resource_list
      x-aor-permissions:
        - 'urn:ge:access_control:resource:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - description: An optional URN prefix filter
          name: prefix
          in: query
          required: false
          type: string
        - name: resource_ids
          description: An optional list of resource ids
          in: query
          type: array
          items:
            type: integer
          required: false
          minItems: 1
          collectionFormat: csv
          uniqueItems: true
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/resource'
      tags:
        - access_control
    post:
      consumes:
        - application/json
      operationId: resource_create
      x-aor-permissions:
        - 'urn:ge:access_control:resource:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/resource_create'
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/resource'
      tags:
        - access_control

  '/resources/{resource_id}':
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/resource_id'
    delete:
      operationId: resource_delete
      x-aor-permissions:
        - 'urn:ge:access_control:resource:delete'
      responses:
        '204':
          description: ''
      tags:
        - access_control
    get:
      operationId: resource_read
      x-aor-permissions:
        - 'urn:ge:access_control:resource:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/resource'
      tags:
        - access_control
    put:
      consumes:
        - application/json
      operationId: resource_update
      x-aor-permissions:
        - 'urn:ge:access_control:resource:update'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/resource_update'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/resource'
      tags:
        - access_control

  /roles:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: role_list
      x-aor-permissions:
        - 'urn:ge:access_control:role:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - name: role_ids
          description: An optional list of role ids
          in: query
          type: array
          items:
            type: integer
          required: false
          minItems: 1
          collectionFormat: csv
          uniqueItems: true
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/role'
      tags:
        - access_control
    post:
      consumes:
        - application/json
      operationId: role_create
      x-aor-permissions:
        - 'urn:ge:access_control:role:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/role_create'
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/role'
      tags:
        - access_control

  '/roles/{role_id}':
    parameters:
      - $ref: '#/parameters/role_id'
    delete:
      operationId: role_delete
      x-aor-permissions:
        - 'urn:ge:access_control:role:delete'
      responses:
        '204':
          description: ''
      tags:
        - access_control
    get:
      operationId: role_read
      x-aor-permissions:
        - 'urn:ge:access_control:role:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/role'
      tags:
        - access_control
    put:
      consumes:
        - application/json
      operationId: role_update
      x-aor-permissions:
        - 'urn:ge:access_control:role:update'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/role_update'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/role'
      tags:
        - access_control

  /roleresourcepermissions:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: roleresourcepermission_list
      x-aor-permissions:
        - 'urn:ge:access_control:roleresourcepermission:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - $ref: '#/parameters/optional_role_filter'
        - description: An optional resource filter
          name: resource_id
          in: query
          required: false
          type: integer
        - description: An optional permission filter
          name: permission_id
          in: query
          required: false
          type: integer
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/role_resource_permission'
      tags:
        - access_control
    post:
      consumes:
        - application/json
      operationId: roleresourcepermission_create
      x-aor-permissions:
        - 'urn:ge:access_control:roleresourcepermission:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/role_resource_permission_create'
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/role_resource_permission'
      tags:
        - access_control

  /roleresourcepermissions/{role_id}/{resource_id}/{permission_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/role_id'
      - $ref: '#/parameters/resource_id'
      - $ref: '#/parameters/permission_id'
    delete:
      operationId: roleresourcepermission_delete
      x-aor-permissions:
        - 'urn:ge:access_control:roleresourcepermission:delete'
      responses:
        '204':
          description: ''
      tags:
        - access_control
    get:
      operationId: roleresourcepermission_read
      x-aor-permissions:
        - 'urn:ge:access_control:roleresourcepermission:update'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/role_resource_permission'
      tags:
        - access_control

  /sites:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: site_list
      x-aor-permissions:
        - 'urn:ge:access_control:site:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - name: site_ids
          description: An optional list of site ids
          in: query
          type: array
          items:
            type: integer
          required: false
          minItems: 1
          collectionFormat: csv
          uniqueItems: true
        - name: client_id
          description: An optional client id to filter on
          in: query
          type: integer
          required: false
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/site'
      tags:
        - access_control
    post:
      consumes:
        - application/json
      operationId: site_create
      x-aor-permissions:
        - 'urn:ge:access_control:site:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/site_create'
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/site'
      tags:
        - access_control

  /sites/{site_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/site_id'
    delete:
      operationId: site_delete
      x-aor-permissions:
        - 'urn:ge:access_control:site:delete'
      responses:
        '204':
          description: ''
      tags:
        - access_control
    get:
      operationId: site_read
      x-aor-permissions:
        - 'urn:ge:access_control:site:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/site'
      tags:
        - access_control
    put:
      consumes:
        - application/json
      operationId: site_update
      x-aor-permissions:
        - 'urn:ge:access_control:site:update'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/site_update'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/site'
      tags:
        - access_control

  /siteroles:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: siterole_list
      x-aor-permissions:
        - 'urn:ge:access_control:siterole:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - $ref: '#/parameters/optional_site_filter'
        - $ref: '#/parameters/optional_role_filter'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/site_role'
      tags:
        - access_control
    post:
      consumes:
        - application/json
      operationId: siterole_create
      x-aor-permissions:
        - 'urn:ge:access_control:siterole:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/site_role_create'
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/site_role'
      tags:
        - access_control

  '/siteroles/{site_id}/{role_id}':
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/site_id'
      - $ref: '#/parameters/role_id'
    delete:
      operationId: siterole_delete
      x-aor-permissions:
        - 'urn:ge:access_control:siterole:delete'
      responses:
        '204':
          description: ''
      tags:
        - access_control
    get:
      operationId: siterole_read
      x-aor-permissions:
        - 'urn:ge:access_control:siterole:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/site_role'
      tags:
        - access_control
    put:
      consumes:
        - application/json
      operationId: siterole_update
      x-aor-permissions:
        - 'urn:ge:access_control:siterole:update'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/site_role_update'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/site_role'
      tags:
        - access_control

  /userdomainroles:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: userdomainrole_list
      x-aor-permissions:
        - 'urn:ge:access_control:userdomainrole:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - $ref: '#/parameters/optional_user_filter'
        - $ref: '#/parameters/optional_domain_filter'
        - $ref: '#/parameters/optional_role_filter'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/user_domain_role'
      tags:
        - access_control
    post:
      consumes:
        - application/json
      operationId: userdomainrole_create
      x-aor-permissions:
        - 'urn:ge:access_control:userdomainrole:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/user_domain_role_create'
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/user_domain_role'
      tags:
        - access_control

  '/userdomainroles/{user_id}/{domain_id}/{role_id}':
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/user_id'
      - $ref: '#/parameters/domain_id'
      - $ref: '#/parameters/role_id'
    delete:
      operationId: userdomainrole_delete
      x-aor-permissions:
        - 'urn:ge:access_control:userdomainrole:delete'
      responses:
        '204':
          description: ''
      tags:
        - access_control
    get:
      operationId: userdomainrole_read
      x-aor-permissions:
        - 'urn:ge:access_control:userdomainrole:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/user_domain_role'
      tags:
        - access_control

  /usersiteroles:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: usersiterole_list
      x-aor-permissions:
        - 'urn:ge:access_control:usersiterole:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - $ref: '#/parameters/optional_user_filter'
        - $ref: '#/parameters/optional_site_filter'
        - $ref: '#/parameters/optional_role_filter'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/user_site_role'
      tags:
        - access_control
    post:
      consumes:
        - application/json
      operationId: usersiterole_create
      x-aor-permissions:
        - 'urn:ge:access_control:usersiterole:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/user_site_role_create'
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/user_site_role'
      tags:
        - access_control

  /usersiteroles/{user_id}/{site_id}/{role_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/user_id'
      - $ref: '#/parameters/site_id'
      - $ref: '#/parameters/role_id'
    delete:
      operationId: usersiterole_delete
      x-aor-permissions:
        - 'urn:ge:access_control:usersiterole:delete'
      responses:
        '204':
          description: ''
      tags:
        - access_control
    get:
      operationId: usersiterole_read
      x-aor-permissions:
        - 'urn:ge:access_control:usersiterole:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/user_site_role'
      tags:
        - access_control

  /usersitedata:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: usersitedata_list
      x-aor-permissions:
        - 'urn:ge:user_data:usersitedata:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - $ref: '#/parameters/optional_user_filter'
        - $ref: '#/parameters/optional_site_filter'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/user_site_data'
      tags:
        - user_data
    post:
      operationId: usersitedata_create
      x-aor-permissions:
        - 'urn:ge:user_data:usersitedata:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/user_site_data_create'
      consumes:
        - application/json
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/user_site_data'
      tags:
        - user_data

  /usersitedata/{user_id}/{site_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/user_id'
      - $ref: '#/parameters/site_id'
    delete:
      operationId: usersitedata_delete
      x-aor-permissions:
        - 'urn:ge:user_data:usersitedata:delete'
      responses:
        '204':
          description: ''
      tags:
        - user_data
    get:
      operationId: usersitedata_read
      x-aor-permissions:
        - 'urn:ge:user_data:usersitedata:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/user_site_data'
      tags:
        - user_data
    put:
      operationId: usersitedata_update
      x-aor-permissions:
        - 'urn:ge:user_data:usersitedata:update'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/user_site_data_update'
      consumes:
        - application/json
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/user_site_data'
      tags:
        - user_data

  /deletedusers:
    get:
      operationId: deleteduser_list
      x-aor-permissions:
        - 'urn:ge:user_data:deleteduser:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - $ref: '#/parameters/optional_deleter_id_filter'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
                type: integer
                description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/deleted_user'
      tags:
        - user_data
    post:
      operationId: deleteduser_create
      x-aor-permissions:
        - 'urn:ge:user_data:deleteduser:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/deleted_user_create'
      consumes:
        - application/json
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/deleted_user'
      tags:
        - user_data

  /deletedusers/{user_id}:
    parameters:
      - $ref: '#/parameters/user_id'
    delete:
      operationId: deleteduser_delete
      x-aor-permissions:
        - 'urn:ge:user_data:deleteduser:delete'
      responses:
        '204':
          description: ''
      tags:
        - user_data
    get:
      operationId: deleteduser_read
      x-aor-permissions:
        - 'urn:ge:user_data:deleteduser:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/deleted_user'
      tags:
        - user_data
    put:
      operationId: deleteduser_update
      x-aor-permissions:
        - 'urn:ge:user_data:deleteduser:update'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/deleted_user_update'
      consumes:
        - application/json
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/deleted_user'
      tags:
        - user_data

  /deletedusersites:
    get:
      operationId: deletedusersite_list
      x-aor-permissions:
        - 'urn:ge:user_data:deletedusersite:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - $ref: '#/parameters/optional_user_filter'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
                type: integer
                description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/deleted_user_site'
      tags:
        - user_data
    post:
      operationId: deletedusersite_create
      x-aor-permissions:
        - 'urn:ge:user_data:deletedusersite:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/deleted_user_site_create'
      consumes:
        - application/json
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/deleted_user_site'
      tags:
        - user_data

  /deletedusersites/{user_id}/{site_id}:
    parameters:
      - $ref: '#/parameters/user_id'
      - $ref: '#/parameters/site_id'
    delete:
      operationId: deletedusersite_delete
      x-aor-permissions:
        - 'urn:ge:user_data:deletedusersite:delete'
      responses:
        '204':
          description: ''
      tags:
        - user_data
    get:
      operationId: deletedusersite_read
      x-aor-permissions:
        - 'urn:ge:user_data:deletedusersite:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/deleted_user_site'
      tags:
        - user_data
    put:
      operationId: deletedusersite_update
      x-aor-permissions:
        - 'urn:ge:user_data:deletedusersite:update'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/deleted_user_site_update'
      consumes:
        - application/json
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/deleted_user_site'
      tags:
        - user_data

  /adminnotes:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: adminnote_list
      x-aor-permissions:
        - 'urn:ge:user_data:adminnote:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - $ref: '#/parameters/optional_user_filter'
        - description: An optional query parameter to filter by creator (a user_id)
          in: query
          name: creator_id
          required: false
          type: string
          format: uuid
        - name: admin_note_ids
          description: An optional list of adminnote ids
          in: query
          type: array
          items:
            type: integer
          required: false
          minItems: 1
          collectionFormat: csv
          uniqueItems: true
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/admin_note'
        403:
          description: 'Forbidden'
      tags:
        - user_data
    post:
      consumes:
        - application/json
      operationId: adminnote_create
      x-aor-permissions:
        - 'urn:ge:user_data:adminnote:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/admin_note_create'
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/admin_note'
        403:
          description: 'Forbidden'
      tags:
        - user_data

  /adminnotes/{admin_note_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/admin_note_id'
    delete:
      operationId: adminnote_delete
      x-aor-permissions:
        - 'urn:ge:user_data:adminnote:delete'
      responses:
        '204':
          description: 'Deleted'
        403:
          description: 'Forbidden'
      tags:
        - user_data
    get:
      operationId: adminnote_read
      x-aor-permissions:
        - 'urn:ge:user_data:adminnote:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/admin_note'
        403:
          description: 'Forbidden'
      tags:
        - user_data
    put:
      consumes:
        - application/json
      operationId: adminnote_update
      x-aor-permissions:
        - 'urn:ge:user_data:adminnote:update'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/admin_note_update'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/admin_note'
        403:
          description: 'Forbidden'
      tags:
        - user_data

  /sitedataschemas:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: sitedataschema_list
      x-aor-permissions:
        - 'urn:ge:user_data:sitedataschema:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - name: site_ids
          description: An optional list of site ids
          in: query
          type: array
          items:
            type: integer
          required: false
          minItems: 1
          collectionFormat: csv
          uniqueItems: true
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/site_data_schema'
      tags:
        - user_data
    post:
      consumes:
        - application/json
      operationId: sitedataschema_create
      x-aor-permissions:
        - 'urn:ge:user_data:sitedataschema:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/site_data_schema_create'
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/site_data_schema'
      tags:
        - user_data

  /sitedataschemas/{site_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/site_id'
    delete:
      operationId: sitedataschema_delete
      x-aor-permissions:
        - 'urn:ge:user_data:sitedataschema:delete'
      responses:
        '204':
          description: ''
      tags:
        - user_data
    get:
      operationId: sitedataschema_read
      x-aor-permissions:
        - 'urn:ge:user_data:sitedataschema:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/site_data_schema'
      tags:
        - user_data
    put:
      operationId: sitedataschema_update
      x-aor-permissions:
        - 'urn:ge:user_data:sitedataschema:update'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/site_data_schema_update'
      consumes:
        - application/json
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/site_data_schema'
      tags:
        - user_data

  /clients:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: client_list
      x-aor-permissions:
        - 'urn:ge:identity_provider:oidc_provider:client:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - name: client_ids
          description: An optional list of client ids
          in: query
          type: array
          items:
            type: integer
          required: false
          minItems: 1
          collectionFormat: csv
          uniqueItems: true
        - description: An optional client id to filter on. This is not the primary key.
          in: query
          name: client_token_id
          required: false
          type: string
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/client'

      tags:
        - authentication

  /clients/{client_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/client_id'
    get:
      operationId: client_read
      x-aor-permissions:
        - 'urn:ge:identity_provider:oidc_provider:client:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/client'
      tags:
        - authentication

  /countries:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: country_list
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - name: country_codes
          description: An optional list of country codes
          in: query
          type: array
          items:
            type: string
            minLength: 2
            maxLength: 2
          required: false
          minItems: 1
          collectionFormat: csv
          uniqueItems: true
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            type: array
            items:
              $ref: '#/definitions/country'
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query

      tags:
        - authentication

  /countries/{country_code}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/country_code'
    get:
      operationId: country_read
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/country'
      tags:
        - authentication

  /invitations/{invitation_id}/send:
    parameters:
      - name: invitation_id
        type: string
        format: uuid
        in: path
        required: true
      - name: language
        type: string
        in: query
        required: false
        default: "en"
    get:
      operationId: invitation_send
      produces:
        - application/json
      responses:
        '200':
          description: 'An invitation email was successfully queued for sending.'
      tags:
        - authentication

  /invitations/purge/expired:
    get:
      operationId: purge_expired_invitations
      parameters:
        - $ref: '#/parameters/synchronous_mode'
        - $ref: '#/parameters/optional_cutoff_date'
      produces:
        - application/json
      responses:
        200:
          description: 'Expired Invitations Purged'
          schema:
            $ref: '#/definitions/purged_invitations'
        403:
          description: 'Forbidden'
      tags:
        - operational

  /request_user_deletion:
    post:
      operationId: request_user_deletion
      consumes:
        - application/json
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/request_user_deletion'
          required: true
      produces:
        - application/json
      responses:
        '200':
          description: ''
      tags:
        - authentication

  /organisations:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: organisation_list
      x-aor-permissions:
        - 'urn:ge:identity_provider:organisation:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - name: organisation_ids
          description: An optional list of organisation ids
          in: query
          type: array
          items:
            type: integer
          required: false
          minItems: 1
          collectionFormat: csv
          uniqueItems: true
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            type: array
            items:
              $ref: '#/definitions/organisation'
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
      tags:
        - authentication
    post:
      consumes:
        - application/json
      operationId: organisation_create
      x-aor-permissions:
        - 'urn:ge:identity_provider:organisation:create'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/organisation_create'
      produces:
        - application/json
      responses:
        '201':
          description: ''
          schema:
            $ref: '#/definitions/organisation'
      tags:
        - authentication

  /organisations/{organisation_id}:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/organisation_id'
    delete:
      operationId: organisation_delete
      x-aor-permissions:
        - 'urn:ge:identity_provider:organisation:delete'
      responses:
        '204':
          description: ''
      tags:
        - authentication
    get:
      operationId: organisation_read
      x-aor-permissions:
        - 'urn:ge:identity_provider:organisation:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/organisation'
      tags:
        - authentication
    put:
      consumes:
        - application/json
      operationId: organisation_update
      x-aor-permissions:
        - 'urn:ge:identity_provider:organisation:update'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/organisation_update'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/organisation'
      tags:
        - authentication

  /users:
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
    get:
      operationId: user_list
      x-aor-permissions:
        - 'urn:ge:identity_provider:user:read'
      parameters:
        - $ref: '#/parameters/optional_offset'
        - $ref: '#/parameters/optional_limit'
        - name: birth_date
          description: An optional birth_date range filter
          in: query
          required: false
          type: string
          x-aor-filter:
            format: date
            range: true
        - name: country
          description: An optional country filter
          in: query
          required: false
          type: string
          minLength: 2
          maxLength: 2
          x-related-info:
            rest_resource_name: countries
            label: name
        - name: date_joined
          description: An optional date joined range filter
          in: query
          required: false
          type: string
          x-aor-filter:
            format: date
            range: true
        - name: email
          description: An optional case insensitive email inner match filter
          in: query
          required: false
          type: string
          minLength: 3
        - name: email_verified
          description: An optional email verified filter
          in: query
          required: false
          type: boolean
        - name: first_name
          description: An optional case insensitive first name inner match filter
          in: query
          required: false
          type: string
          minLength: 3
        - name: gender
          description: An optional gender filter
          in: query
          required: false
          type: string
        - name: is_active
          description: An optional is_active filter
          in: query
          required: false
          type: boolean
        - name: last_login
          description: An optional last login range filter
          in: query
          required: false
          type: string
          x-aor-filter:
            format: date
            range: true
        - name: last_name
          description: An optional case insensitive last name inner match filter
          in: query
          required: false
          type: string
          minLength: 3
        - name: msisdn
          description: An optional case insensitive MSISDN inner match filter
          in: query
          required: false
          type: string
          minLength: 3
        - name: msisdn_verified
          description: An optional MSISDN verified filter
          in: query
          required: false
          type: boolean
        - name: nickname
          description: An optional case insensitive nickname inner match filter
          in: query
          required: false
          type: string
          minLength: 3
        - name: organisation_id
          description: An optional filter on the organisation id
          in: query
          required: false
          type: integer
        - name: updated_at
          description: An optional updated_at range filter
          in: query
          required: false
          type: string
          x-aor-filter:
            format: date-time
            range: true
        - name: username
          description: An optional case insensitive username inner match filter
          in: query
          required: false
          type: string
          minLength: 3
        - name: q
          description: An optional case insensitive inner match filter across all searchable text fields
          in: query
          required: false
          type: string
          minLength: 3
        - name: tfa_enabled
          description: An optional filter based on whether a user has 2FA enabled or not
          in: query
          required: false
          type: boolean
        - name: has_organisation
          description: An optional filter based on whether a user belongs to an organisation or not
          in: query
          required: false
          type: boolean
        - name: order_by
          description: Fields and directions to order by, e.g. "-created_at,username". Add "-" in front
            of a field name to indicate descending order.
          in: query
          required: false
          type: array
          collectionFormat: csv
          items:
            type: string
          uniqueItems: true
        - name: user_ids
          description: An optional list of user ids
          in: query
          type: array
          items:
            type: string
            format: uuid
          required: false
          minItems: 1
          collectionFormat: csv
          uniqueItems: true
        - name: site_ids
          description: An optional list of site ids
          in: query
          type: array
          items:
            type: integer
          required: false
          minItems: 1
          collectionFormat: csv
          uniqueItems: true
          x-related-info:
            rest_resource_name: sites
            label: name
      produces:
        - application/json
      responses:
        '200':
          description: ''
          headers:
            X-Total-Count:
              type: integer
              description: The total number of results matching the query
          schema:
            type: array
            items:
              $ref: '#/definitions/user'
      tags:
        - authentication

  '/users/{user_id}':
    parameters:
      - $ref: '#/parameters/optional_portal_context_header'
      - $ref: '#/parameters/user_id'
    delete:
      operationId: user_delete
      x-aor-permissions:
        - 'urn:ge:identity_provider:user:delete'
      responses:
        '204':
          description: ''
      tags:
        - authentication
    get:
      operationId: user_read
      x-aor-permissions:
        - 'urn:ge:identity_provider:user:read'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/user'
      tags:
        - authentication

    put:
      consumes:
        - application/json
      operationId: user_update
      x-aor-permissions:
        - 'urn:ge:identity_provider:user:update'
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/user_update'
      produces:
        - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/user'
      tags:
        - authentication

x-detail-page-definitions:
  domain:
    inlines:
    - model: domain
      label: Child Domains
      key: parent_id
      fields:
        - id
        - name
        - created_at
        - updated_at
    - model: domain_role
      label: Roles
      key: domain_id
      fields:
        - role_id
        - created_at
        - updated_at
#    sortable_fields:
#      - id
#  domainrole:
#    sortable_fields:
#      - domain_id
#      - role_id
  invitation:
    inlines:
    - model: invitation_domain_role
      label: Domain Roles
      key: invitation_id
      fields:
        - domain_id
        - role_id
        - created_at
        - updated_at
    - model: invitation_site_role
      label: Site Roles
      key: invitation_id
      fields:
        - site_id
        - role_id
        - created_at
        - updated_at
#    sortable_fields:
#      - id
#  invitationdomainrole:
#    sortable_fields:
#      - invitation_id
#      - domain_id
#      - role_id
#  invitationsiterole:
#    sortable_fields:
#      - invitation_id
#      - site_id
#      - role_id
#  permission:
#    sortable_fields:
#      - id
#  resource:
#    sortable_fields:
#      - id
  role:
    inlines:
    - model: role_resource_permission
      label: Resource Permissions
      key: role_id
      fields:
        - resource_id
        - permission_id
        - created_at
        - updated_at
#    sortable_fields:
#      - id
#  roleresourcepermission:
#    sortable_fields:
#      - id
  site:
    inlines:
    - model: site_role
      label: Roles
      key: site_id
      fields:
        - role_id
        - created_at
        - updated_at
#    sortable_fields:
#      - id
#  siteroles:
#    sortable_fields:
#      - site_id
#      - role_id
#  userdomainrole:
#    sortable_fields:
#      - user_id
#      - domain_id
#      - role_id
#  usersiterole:
#    sortable_fields:
#      - user_id
#      - domain_id
#      - role_id
#  usersitedata:
#    sortable_fields:
#      - user_id
#      - site_id
#  adminnote:
#    sortable_fields:
#      - id
#  sitedataschema:
#    sortable_fields:
#      - site_id
#  client:
#    sortable_fields:
#      - id
#      - client_id
#  country:
#    sortable_fields:
#      - code
#  organisation:
#    sortable_fields:
#      - id
  user:
    inlines:
    - model: user_domain_role
      label: Domain Roles
      key: user_id
      fields:
        - domain_id
        - role_id
        - created_at
        - updated_at
    - model: user_site_data
      rest_resource_name: usersitedata
      label: Site Data
      key: user_id
      fields:
        - site_id
        - data
        - created_at
        - updated_at
    - model: user_site_role
      label: Site Roles
      key: user_id
      fields:
        - site_id
        - role_id
        - created_at
        - updated_at
    sortable_fields:
      - id
  deleteduser:
    inlines:
    - model: deleted_user_site
      label: Sites which the user visited
      key: deleted_user_id
      fields:
      - site_id
      - deletion_requested_at
      - deletion_requested_via
      - deletion_confirmed_at
      - deletion_confirmed_via
      - created_at
      - updated_at

